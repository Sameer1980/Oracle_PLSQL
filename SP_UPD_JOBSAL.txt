CREATE OR REPLACE PROCEDURE SP_UPD_JOBSAL (P_JOBID VARCHAR2,P_MINSAL NUMBER,P_MAXSAL NUMBER) AS

V_COUNT NUMBER:=0;

INVALID_JOB EXCEPTION;

WRONG_FIGURES EXCEPTION;
  
ROW_LOCKED EXCEPTION;
PRAGMA EXCEPTION_INIT (ROW_LOCKED,-54);

BEGIN
FOR C1 IN(SELECT * FROM JOBS WHERE JOB_ID=P_JOBID FOR UPDATE NOWAIT) LOOP
NULL;
END LOOP;


IF P_MAXSAL < P_MINSAL THEN
RAISE WRONG_FIGURES;
END IF;

SELECT COUNT(*) INTO V_COUNT FROM JOBS WHERE JOB_ID=P_JOBID;

IF V_COUNT <> 0 THEN
UPDATE JOBS SET MIN_SALARY=P_MINSAL,MAX_SALARY=P_MAXSAL WHERE JOB_ID=P_JOBID;
COMMIT;
ELSE 
RAISE INVALID_JOB;
END IF;


EXCEPTION

WHEN ROW_LOCKED THEN
DBMS_OUTPUT.PUT_LINE('ERR-0105 : THIS ROW IS LOCKED.............' );

WHEN INVALID_JOB THEN
DBMS_OUTPUT.PUT_LINE('ERR-0103 : INVALID JOB');

WHEN WRONG_FIGURES THEN
ROLLBACK;
DBMS_OUTPUT.PUT_LINE('ERR-0104 : MAXIMUM SALARY CANNOT BE LESS THAN THE MINIMUM SALARY.');
 
END;
/
SHOW ERRORS;