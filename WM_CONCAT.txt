SELECT * FROM (
SELECT t.emp_id,
A.EMP_CODE "Emp Code",
INITCAP(A.EMP_FIRST_NAME)||' '||INITCAP(A.EMP_MID_NAME)||' '||INITCAP(A.EMP_LAST_NAME)"Name",
t.dpname "Dependant Name",
T.DPRELATION "Relationship",
DECODE(C1.PARENT_DISCIPLINE_DESC,'Paramedical','Medical',C1.PARENT_DISCIPLINE_DESC) "Discipline"
FROM
M_PIS_EMPLOYEE A,
M_PIS_DISCIPLINE C,
M_PIS_PARENT_DISCIPLINE C1,
M_PIS_EMP_CATEGORY E,
(select emp_id,wm_concat(delete_flag),
wm_concat(DISTINCT initcap(DEPENDANT_FIRST_NAME||' '||DEPENDANT_MID_NAME||' '||DEPENDANT_LAST_NAME)||'-'||RELATIONSHIP)
DPNAME,
wm_concat(RELATIONSHIP)DPRELATION FROM T_PIS_DEPENDANT T where delete_flag='N' group by emp_id 
order by emp_id) T
WHERE
A.DISCIPLINE_ID=C.DISCIPLINE_ID
AND
C.PARENT_DISCIPLINE_ID=C1.PARENT_DISCIPLINE_ID
AND
A.EMP_CATEGORY_ID=E.EMP_CATEGORY_ID
AND
A.EMP_ID=T.EMP_ID(+)
AND
A.EMP_CATEGORY_ID=1
AND
A.DELETE_FLAG='N'
AND
A.SEPARATION_CODE IS NULL
)
order by 4


