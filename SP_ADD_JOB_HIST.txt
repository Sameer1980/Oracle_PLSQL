CREATE OR REPLACE PROCEDURE SP_ADD_JOB_HIST(EMP_ID NUMBER,J_ID VARCHAR2) AS

V_COUNT NUMBER:=0;

NON_EXISTENT_EMP EXCEPTION;
BEGIN

SELECT COUNT(*) INTO V_COUNT FROM EMPLOYEES WHERE EMPLOYEE_ID=EMP_ID;

IF V_COUNT <> 0 THEN 
INSERT INTO JOB_HISTORY(EMPLOYEE_ID,START_DATE,END_DATE,JOB_ID,DEPARTMENT_ID)
SELECT EMPLOYEE_ID,HIRE_DATE,SYSDATE,JOB_ID,DEPARTMENT_ID FROM EMPLOYEES WHERE EMPLOYEE_ID=EMP_ID;


UPDATE EMPLOYEES 
SET HIRE_DATE=SYSDATE,
JOB_ID=J_ID,
SALARY=(SELECT MIN_SALARY + 500 FROM JOBS WHERE JOB_ID=J_ID)
WHERE
EMPLOYEE_ID=EMP_ID;       

COMMIT;

ELSE RAISE NON_EXISTENT_EMP;

END IF;

EXCEPTION
WHEN NON_EXISTENT_EMP THEN
ROLLBACK;
DBMS_OUTPUT.PUT_LINE('ERR:0102.... EMPLOYEE DOES NOT EXIST');
END;
/
SHOW ERRORS;