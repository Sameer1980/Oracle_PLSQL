CREATE OR REPLACE PROCEDURE LIST_EMPLOYEES(DEPTID NUMBER) IS
TYPE EMP_REFCSR IS REF CURSOR;
EMP_CV EMP_REFCSR;
EMPREC EMPLOYEES%ROWTYPE;
STMT VARCHAR2(200):='SELECT * FROM EMPLOYEES ';
VAR_COUNT NUMBER;
BEGIN
IF DEPTID IS NULL 
THEN OPEN EMP_CV FOR STMT;
ELSE
STMT:=STMT||' WHERE DEPARTMENT_ID=:ID';
OPEN EMP_CV FOR STMT USING DEPTID;
END IF;
LOOP
FETCH EMP_CV INTO EMPREC;
EXIT WHEN EMP_CV%NOTFOUND;
DBMS_OUTPUT.PUT_LINE(EMPREC.DEPARTMENT_ID||' '||EMPREC.LAST_NAME);
VAR_COUNT:=EMP_CV%ROWCOUNT;
END LOOP;
CLOSE EMP_CV;
DBMS_OUTPUT.PUT_LINE('TOTAL COUNT: '||VAR_COUNT);
END;
